<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ChatBOT</title>
    <link href="design.css">
    <link rel="stylesheet" href="design.css">

    
</head>

<body>
    <header>ChatBOT</header>

    <div id="chatbox"></div>
    

    <footer>
        <input type="text" id="userInput" placeholder="Ask anything...">
        <button onclick="sendMessage()" id="sendBtn">
            <img src="icons8-send-94.png" alt="Send" class="send-icon">
        </button>
        
    </footer>
    <div class="foot">
            <b>© Copyright 2025 | <AI-poweredby>sourya791m</AI-poweredby></b>
        </div>

    <script>
        const API_KEY = "AIzaSyC_VKm8zrhpdry8xdqxUC5aGsk2veZKxHY"; // API KEY
        const DEFAULT_MODEL = "gemini-2.5-flash"; // SELECTED MODEL
        const chatbox = document.getElementById("chatbox");

        function addMessage(message, sender) {
            const div = document.createElement("div");
            div.classList.add("message", sender);
            div.innerHTML = formatMarkdown(message);
            chatbox.appendChild(div);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        function showTyping() {
            const typingDiv = document.createElement("div");
            typingDiv.classList.add("typing-indicator");
            typingDiv.innerHTML = `<span class="dot"></span><span class="dot"></span><span class="dot"></span>`;
            chatbox.appendChild(typingDiv);
            chatbox.scrollTop = chatbox.scrollHeight;
            return typingDiv;
        }

        function formatMarkdown(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
                .replace(/\n- (.*?)/g, "<ul><li>$1</li></ul>")
                .replace(/\n\d+\.\s(.*?)/g, "<ol><li>$1</li></ol>");
        }

        async function sendMessage() {
            const model = DEFAULT_MODEL;
            const text = document.getElementById("userInput").value.trim();
            if (!text || !model) return;
            addMessage(text, "user");
            document.getElementById("userInput").value = "";

            const typing = showTyping();

            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${API_KEY}`,
                    {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{
                                role: "user",
                                parts: [{ text }]
                            }]
                        })
                    }
                );

                if (response.status === 429) {
                    typing.remove();
                    addMessage("⚠️ Rate limit exceeded. Please try again later.", "bot");
                    return;
                }

                const data = await response.json();
                console.log("API Response:", data);
                typing.remove();

                const botReply = data?.candidates?.[0]?.content?.parts?.[0]?.text || "⚠️ Could not generate response.";
                addMessage(botReply, "bot");
                speakText(botReply); // 👈 Added line for speech

            } catch (err) {
                typing.remove();
                console.error("API Error:", err);
                addMessage("⚠️ API Error: Could not connect. Check your API key and internet.", "bot");
            }
        }

        // 🔊 Function to make the bot speak
        function speakText(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.pitch = 1;
                utterance.rate = 1;
                utterance.volume = 1;
                speechSynthesis.speak(utterance);
            } else {
                console.log("Speech synthesis not supported in this browser.");
            }
        }

        document.getElementById("userInput").addEventListener("keypress", e => {
            if (e.key === "Enter") sendMessage();
        });
        addMessage("This simple AI-powered ChatBOT is designed to answer questions on AI, education, and related topics. Feel free to ask anything educational!", "bot");
    </script>
</body>

</html>
